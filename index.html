<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>TNAA Explorer åŸå‹é¢„è§ˆ</title>
    <style>
        :root { --bg: #ffffff; --text: #000000; --border: #eeeeee; --subText: #666666; --row: #ffffff; --accent: #007AFF; }
        @media (prefers-color-scheme: dark) {
            :root { --bg: #000000; --text: #ffffff; --border: #222222; --subText: #888888; --row: #000000; }
        }

        body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif; margin: 0; background: var(--bg); color: var(--text); overflow-x: hidden; }
        
        /* åˆ—è¡¨é¡µæ ·å¼ */
        .header { display: flex; justify-content: space-between; align-items: center; padding: 20px; border-bottom: 1px solid var(--border); }
        .title { font-size: 22px; font-weight: 900; }
        .add-btn { background: var(--accent); color: white; padding: 8px 16px; border-radius: 20px; border: none; font-weight: bold; cursor: pointer; }
        
        .file-item { display: flex; align-items: center; border-bottom: 1px solid var(--border); transition: background 0.2s; }
        .file-info { flex: 1; padding: 20px; cursor: pointer; }
        .action-group { display: flex; padding-right: 10px; }
        .icon-btn { padding: 12px; cursor: pointer; font-size: 18px; border: none; background: none; }

        /* ç¼–è¾‘æ¨¡æ€æ¡† */
        #editor-modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: var(--bg); z-index: 200; flex-direction: column; }
        .modal-header { display: flex; justify-content: space-between; padding: 15px; border-bottom: 1px solid var(--border); align-items: center; }
        textarea { flex: 1; width: 100%; border: none; padding: 15px; font-family: monospace; font-size: 16px; background: var(--bg); color: var(--text); outline: none; box-sizing: border-box; }

        /* è¿è¡Œç•Œé¢ï¼šæ²‰æµ¸å¼ */
        #runner-screen { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: #000; z-index: 300; }
        iframe { width: 100%; height: 100%; border: none; background: white; }

        /* æ‚¬æµ®çƒæŒ‰é’® */
        #floating-exit {
            position: absolute; width: 50px; height: 50px; border-radius: 25px;
            background: rgba(0,0,0,0.5); border: 1px solid rgba(255,255,255,0.2);
            color: white; display: flex; align-items: center; justify-content: center;
            cursor: move; font-weight: bold; z-index: 400; transition: opacity 0.8s;
            box-shadow: 0 4px 10px rgba(0,0,0,0.3);
            user-select: none;
        }
    </style>
</head>
<body>

    <div id="app">
        <div class="header">
            <div>
                <div class="title">TNAA Explorer</div>
                <div style="font-size: 12px; color: var(--subText); margin-top: 4px;" id="pos-indicator">é€€å‡ºé”®ä½ç½®: å³ä¸Š (é¢„è§ˆæ¨¡å¼)</div>
            </div>
            <button class="add-btn" onclick="createNewFile()">+ æ–°å»º</button>
        </div>
        <div id="file-list">
            <div class="file-item">
                <div class="file-info" onclick="runFile('index.html')">ğŸ“„ index.html</div>
                <div class="action-group">
                    <button class="icon-btn" onclick="shareFile()">ğŸ“¤</button>
                    <button class="icon-btn" onclick="openEditor('index.html')">ğŸ“</button>
                </div>
            </div>
        </div>
    </div>

    <div id="editor-modal">
        <div class="modal-header">
            <span style="color: #FF3B30; cursor: pointer;" onclick="closeEditor()">å–æ¶ˆ</span>
            <b id="editor-title">ä»£ç ç¼–è¾‘</b>
            <span style="color: var(--accent); font-weight: bold; cursor: pointer;" onclick="saveFile()">ä¿å­˜</span>
        </div>
        <textarea id="code-input" spellcheck="false"></textarea>
    </div>

    <div id="runner-screen">
        <div id="floating-exit" onclick="closeRunner()">âœ•</div>
        <iframe id="viewer"></iframe>
    </div>

    <script>
        // æ¨¡æ‹Ÿæ–‡ä»¶ç³»ç»Ÿå­˜å‚¨
        let files = JSON.parse(localStorage.getItem('tnaa_files')) || {
            'index.html': '<html><body style="display:flex;justify-content:center;align-items:center;height:100vh;"><h1>Hello TNAA!</h1></body></html>'
        };
        let currentEditingName = '';

        // æ¸²æŸ“åˆ—è¡¨
        function renderList() {
            const list = document.getElementById('file-list');
            list.innerHTML = '';
            Object.keys(files).sort().forEach(name => {
                list.innerHTML += `
                    <div class="file-item">
                        <div class="file-info" onclick="runFile('${name}')">ğŸ“„ ${name}</div>
                        <div class="action-group">
                            <button class="icon-btn" onclick="alert('è§¦å‘ç³»ç»ŸåŸç”Ÿåˆ†äº«')">ğŸ“¤</button>
                            <button class="icon-btn" onclick="openEditor('${name}')">ğŸ“</button>
                        </div>
                    </div>`;
            });
            localStorage.setItem('tnaa_files', JSON.stringify(files));
        }

        // æ–°å»ºé€»è¾‘
        function createNewFile() {
            const name = prompt("è¯·è¾“å…¥æ–‡ä»¶å", "new_page");
            if (!name) return;
            const fileName = name.endsWith('.html') ? name : name + '.html';
            files[fileName] = '<html><body style="background:#fff"><h1>æ–°é¡µé¢</h1></body></html>';
            renderList();
        }

        // ç¼–è¾‘é€»è¾‘
        function openEditor(name) {
            currentEditingName = name;
            document.getElementById('editor-title').innerText = name;
            document.getElementById('code-input').value = files[name];
            document.getElementById('editor-modal').style.display = 'flex';
        }

        function saveFile() {
            files[currentEditingName] = document.getElementById('code-input').value;
            closeEditor();
            renderList();
        }

        function closeEditor() {
            document.getElementById('editor-modal').style.display = 'none';
        }

        // è¿è¡Œé€»è¾‘ï¼ˆå…¨å±æ²‰æµ¸ï¼‰
        function runFile(name) {
            const runner = document.getElementById('runner-screen');
            const viewer = document.getElementById('viewer');
            const exitBtn = document.getElementById('floating-exit');
            
            runner.style.display = 'block';
            exitBtn.style.opacity = '1';
            
            // æ¨¡æ‹Ÿé€€å‡ºé”®ä½ç½®ï¼ˆå›ºå®šåœ¨å³ä¸Šè§’ï¼Œå¸¦è‡ªåŠ¨æ·¡å‡ºï¼‰
            exitBtn.style.top = '20px';
            exitBtn.style.right = '20px';
            
            const doc = viewer.contentDocument || viewer.contentWindow.document;
            doc.open();
            doc.write(files[name]);
            doc.close();

            // 3ç§’åè‡ªåŠ¨æ·¡å‡ºé€€å‡ºé”®
            setTimeout(() => { exitBtn.style.opacity = '0.3'; }, 3000);
        }

        function closeRunner() {
            document.getElementById('runner-screen').style.display = 'none';
        }

        // ç®€å•çš„æ‹–æ‹½æ¨¡æ‹Ÿ
        const dragBtn = document.getElementById('floating-exit');
        dragBtn.onmousedown = function(e) {
            dragBtn.style.opacity = '1';
            // æ­¤å¤„å¯æ·»åŠ æ›´å¤æ‚çš„æ‹–æ‹½é€»è¾‘ï¼ŒåŸå‹æ¼”ç¤ºç‚¹å‡»å³å¯
        };

        renderList();
    </script>
</body>
</html>